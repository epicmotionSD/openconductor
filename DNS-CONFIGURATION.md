# OpenConductor DNS Configuration Guide

## Overview
This guide provides comprehensive DNS setup instructions for OpenConductor production deployment across multiple services.

## Domain Structure

```
Primary Domain: openconductor.ai
├── app.openconductor.ai       → Vercel Frontend
├── api.openconductor.ai       → Railway Backend API
├── admin.openconductor.ai     → Admin Dashboard
├── docs.openconductor.ai      → Documentation Site  
├── status.openconductor.ai    → Status Page
└── cdn.openconductor.ai       → CDN/Assets
```

## Required DNS Records

### 1. Frontend (Vercel) - app.openconductor.ai

```dns
# CNAME Record (Recommended)
Type: CNAME
Name: app
Value: cname.vercel-dns.com
TTL: 3600

# Alternative A Records (if CNAME not available)
Type: A
Name: app
Value: 76.76.19.61
TTL: 300

Type: A  
Name: app
Value: 76.76.21.21
TTL: 300
```

### 2. Backend API (Railway) - api.openconductor.ai

```dns
# CNAME Record
Type: CNAME
Name: api
Value: [your-railway-app].railway.app
TTL: 3600

# Example:
# Type: CNAME
# Name: api  
# Value: openconductor-api-production-a1b2.up.railway.app
# TTL: 3600
```

### 3. WebSocket (Railway) - ws.openconductor.ai

```dns
# CNAME Record (same as API)
Type: CNAME
Name: ws
Value: [your-railway-app].railway.app
TTL: 3600
```

### 4. Root Domain Redirect

```dns
# A Records for root domain
Type: A
Name: @
Value: 76.76.19.61
TTL: 300

Type: A
Name: @  
Value: 76.76.21.21
TTL: 300

# AAAA Records for IPv6
Type: AAAA
Name: @
Value: 2606:4700::6810:84c5
TTL: 300

Type: AAAA
Name: @
Value: 2606:4700::6810:85c5
TTL: 300
```

### 5. Additional Services

```dns
# Admin Dashboard (if separate)
Type: CNAME
Name: admin
Value: cname.vercel-dns.com
TTL: 3600

# Documentation
Type: CNAME  
Name: docs
Value: cname.vercel-dns.com
TTL: 3600

# Status Page
Type: CNAME
Name: status
Value: cname.vercel-dns.com  
TTL: 3600

# CDN (if using custom CDN)
Type: CNAME
Name: cdn
Value: [your-cdn-endpoint]
TTL: 86400
```

### 6. Email & Security Records

```dns
# MX Records (for transactional emails)
Type: MX
Name: @
Value: 10 feedback-smtp.us-east-1.amazonses.com
TTL: 3600

# SPF Record
Type: TXT
Name: @
Value: "v=spf1 include:amazonses.com ~all"
TTL: 3600

# DKIM (generated by SES)
Type: CNAME
Name: [selector]._domainkey
Value: [selector]._domainkey.[region].amazonses.com
TTL: 3600

# DMARC Policy
Type: TXT
Name: _dmarc
Value: "v=DMARC1; p=quarantine; rua=mailto:dmarc@openconductor.ai"
TTL: 3600
```

## DNS Provider-Specific Instructions

### Cloudflare Setup

1. **Add Domain to Cloudflare**
   ```bash
   # Login to Cloudflare Dashboard
   # Add site: openconductor.ai
   # Update nameservers at registrar
   ```

2. **DNS Records Configuration**
   ```bash
   # Use Cloudflare Dashboard or API
   curl -X POST "https://api.cloudflare.com/client/v4/zones/[zone-id]/dns_records" \
        -H "Authorization: Bearer [api-token]" \
        -H "Content-Type: application/json" \
        --data '{
          "type": "CNAME",
          "name": "app",
          "content": "cname.vercel-dns.com",
          "ttl": 3600,
          "proxied": false
        }'
   ```

3. **SSL/TLS Settings**
   - SSL/TLS encryption mode: **Full (strict)**
   - Always Use HTTPS: **On**
   - HTTP Strict Transport Security (HSTS): **On**
   - Minimum TLS Version: **1.2**

### Route 53 Setup

```json
{
  "Comment": "OpenConductor DNS Configuration",
  "Changes": [
    {
      "Action": "CREATE",
      "ResourceRecordSet": {
        "Name": "app.openconductor.ai",
        "Type": "CNAME",
        "TTL": 3600,
        "ResourceRecords": [
          {
            "Value": "cname.vercel-dns.com"
          }
        ]
      }
    },
    {
      "Action": "CREATE", 
      "ResourceRecordSet": {
        "Name": "api.openconductor.ai",
        "Type": "CNAME",
        "TTL": 3600,
        "ResourceRecords": [
          {
            "Value": "openconductor-api.railway.app"
          }
        ]
      }
    }
  ]
}
```

## SSL Certificate Configuration

### 1. Vercel Automatic SSL
- Vercel automatically provisions SSL certificates for custom domains
- Uses Let's Encrypt certificates with auto-renewal
- No manual configuration required

### 2. Railway SSL Setup
```bash
# Railway automatically handles SSL for custom domains
railway domain add api.openconductor.ai
railway domain add ws.openconductor.ai
```

### 3. Cloudflare SSL (if using)
- **Origin Certificates**: Generate for Railway backend
- **Edge Certificates**: Automatic for all subdomains
- **Universal SSL**: Enabled by default

## Domain Verification Steps

### 1. Verify Vercel Domain
```bash
# Check DNS propagation
dig app.openconductor.ai CNAME
nslookup app.openconductor.ai

# Verify SSL certificate
curl -I https://app.openconductor.ai
openssl s_client -connect app.openconductor.ai:443 -servername app.openconductor.ai
```

### 2. Verify Railway Domain  
```bash
# Check API endpoint
curl -I https://api.openconductor.ai/health
curl -I https://api.openconductor.ai/api/v1/health

# Test WebSocket connection
wscat -c wss://api.openconductor.ai/ws
```

### 3. DNS Propagation Check
```bash
# Use multiple DNS servers to verify propagation
dig @8.8.8.8 app.openconductor.ai
dig @1.1.1.1 api.openconductor.ai  
dig @208.67.222.222 openconductor.ai

# Online tools:
# - https://dnschecker.org/
# - https://www.whatsmydns.net/
# - https://dns.google/
```

## Security Headers Configuration

### Vercel Headers (vercel.json)
```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Strict-Transport-Security",
          "value": "max-age=31536000; includeSubDomains; preload"
        },
        {
          "key": "X-Content-Type-Options", 
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "Content-Security-Policy",
          "value": "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';"
        }
      ]
    }
  ]
}
```

## Monitoring & Testing

### 1. DNS Monitoring
```bash
# Set up DNS monitoring alerts
# Monitor TTL changes
# Track DNS resolution times
# Alert on DNS failures
```

### 2. SSL Certificate Monitoring  
```bash
# Monitor certificate expiration
# Set up renewal alerts  
# Test SSL configuration
# Monitor certificate chain
```

### 3. Performance Testing
```bash
# DNS resolution performance
dig +trace openconductor.ai

# SSL handshake performance  
curl -w "@curl-format.txt" -o /dev/null -s https://app.openconductor.ai

# End-to-end connectivity
curl -I https://app.openconductor.ai
curl -I https://api.openconductor.ai/health
```

## Troubleshooting

### Common Issues

1. **DNS Not Propagating**
   - Check TTL values (lower for faster propagation)
   - Verify nameserver configuration
   - Clear local DNS cache: `sudo dscacheutil -flushcache`

2. **SSL Certificate Issues**
   - Verify domain ownership
   - Check certificate chain
   - Ensure proper CNAME configuration

3. **CORS Issues**
   - Verify domain matching in backend configuration
   - Check protocol (https vs http)
   - Validate origin headers

### Support Resources

- **Vercel DNS**: https://vercel.com/docs/concepts/projects/custom-domains
- **Railway Domains**: https://docs.railway.app/deploy/custom-domains
- **Cloudflare SSL**: https://developers.cloudflare.com/ssl/
- **DNS Tools**: https://toolbox.googleapps.com/apps/dig/

## Production Checklist

- [ ] All DNS records configured
- [ ] SSL certificates provisioned
- [ ] Domain verification completed
- [ ] Security headers implemented
- [ ] DNS propagation verified
- [ ] Performance tested
- [ ] Monitoring configured
- [ ] Backup DNS provider configured
- [ ] Certificate renewal automation verified